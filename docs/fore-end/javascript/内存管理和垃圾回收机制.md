#### 内存管理和垃圾回收机制

##### 1. 认识内存管理

不管是什么编程语言，在代码执行过程中都需要给它分配内存，不同的是有些编程语言需要手动管理内存，有些编程语言可以自动帮助我们管理内存。

##### 2. 内存的生命周期

（1）申请/分配（malloc）需要的内存

（2）使用分配的内存（存放对象等等）

（3）不使用时，释放（free）内存

> **手动管理内存**：
>
> 例如C、C++，早期的OC，通过malloc和free函数申请和释放内存。
>
> **自动管理内存：**
>
> 例如Java，JavaScript，Python，Swift，Dart

##### 3. JavaScript的内存管理

定义变量的时候JavaScript会自动给变量分配内存

**（1）基本数据类型内存分配**

​		JavaScript直接在栈空间进行分配

**（2）复杂数据类型内存分配**

​		对于复杂的数据，JavaScript会在堆内存开辟一块空间，并且将这块空间的指针返回给变量引用

![image-20211203172919495](@alias/image-20211203172919495.png)

##### 4. JS的垃圾回收机制（GC）

垃圾回收：Garbage Collection

Java的运行环境JVM，JavaScript的运行环境js引擎都会内存垃圾回收器。



##### 5. GC算法

那么，JS是如何进行垃圾回收，通过GC算法。

**（1）GC算法-引用计数**

**解释：**

每一个对象都有一个引用retain count  = 0 ,  初始值为0；当有一个引用指向它的时候，该引用的retain count++，当引用为null的时候，就retain count--，所以当一个对象的引用为0时，该对象就会被摧毁。

**弊端：**

循环引用永远都不会被摧毁。

![image-20211204090650094](@alias/image-20211204090650094.png)



**（2）GC算法-标记清除**

设置一个根对象（root object），垃圾回收器会从这个根开始，找所有从根开始有引用的对象，对于没有被引用的对象，垃圾回收时就会被清除。

![image-20211204090904493](@alias/image-20211204090904493.png)

JS引擎广泛用标记清除法，当然在算法的实现上也会结合一些其它的算法。

<Valine></Valine>

